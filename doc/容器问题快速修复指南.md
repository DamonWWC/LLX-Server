# å®¹å™¨é—®é¢˜å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸš¨ é—®é¢˜ç—‡çŠ¶

åœ¨Linuxå®¹å™¨ä¸­è¿è¡Œæ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

```
Failed to write log: Access to the path '/app/logs/error-2025-10-22.log' is denied.
Failed to connect to 127.0.0.1:5432
UnableToConnect on localhost:6379
```

## âš¡ å¿«é€Ÿä¿®å¤ï¼ˆæ¨èï¼‰

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ä¿®å¤è„šæœ¬

#### Linux/Mac ç¯å¢ƒ

```bash
# 1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /path/to/LLX.Server

# 2. æ‰§è¡Œä¿®å¤è„šæœ¬
./LLX.Server/scripts/fix-container-issues.sh

# 3. å¼ºåˆ¶ä¿®å¤ï¼ˆä¸è¯¢é—®ç¡®è®¤ï¼‰
./LLX.Server/scripts/fix-container-issues.sh -f
```

#### Windows ç¯å¢ƒ

```powershell
# 1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd E:\èµ„æ–™\å­¦ä¹ ä»£ç \LLX.Server

# 2. æ‰§è¡Œä¿®å¤è„šæœ¬
.\LLX.Server\scripts\fix-container-issues.ps1

# 3. å¼ºåˆ¶ä¿®å¤ï¼ˆä¸è¯¢é—®ç¡®è®¤ï¼‰
.\LLX.Server\scripts\fix-container-issues.ps1 -Force
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ä¿®å¤

#### 1. ä¿®å¤æ—¥å¿—æƒé™

```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs
chmod 755 logs

# è®¾ç½®æ­£ç¡®çš„æ‰€æœ‰æƒ
sudo chown -R $USER:$USER logs
```

#### 2. ä¿®å¤ç½‘ç»œè¿æ¥

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp env.api-only.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

**ä¿®æ”¹å…³é”®é…ç½®**ï¼š

```bash
# å°† localhost æ”¹ä¸º host.docker.internal
DB_CONNECTION_STRING=Host=host.docker.internal;Port=5432;Database=llxrice;Username=llxrice_user;Password=your_password;Pooling=true;Minimum Pool Size=5;Maximum Pool Size=100;Command Timeout=30

REDIS_CONNECTION_STRING=host.docker.internal:6379,password=your_redis_password,ssl=false,abortConnect=false
```

#### 3. é‡æ–°æ„å»ºå’Œå¯åŠ¨

```bash
# é‡æ–°æ„å»ºé•œåƒ
docker build -f LLX.Server/Dockerfile -t llxrice/api:latest .

# åœæ­¢ç°æœ‰å®¹å™¨
docker stop llxrice_api
docker rm llxrice_api

# å¯åŠ¨æ–°æœåŠ¡
docker-compose -f docker-compose.api-only.yml up -d
```

## ğŸ” éªŒè¯ä¿®å¤

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps --filter "name=llxrice_api"

# æŸ¥çœ‹æ—¥å¿—
docker logs llxrice_api

# å¥åº·æ£€æŸ¥
curl http://localhost:8080/health
```

### æ£€æŸ¥æƒé™

```bash
# æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
docker exec llxrice_api ls -la /app/logs

# æ£€æŸ¥å®¿ä¸»æœºæ—¥å¿—ç›®å½•
ls -la logs/
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### 1. æƒé™é—®é¢˜æŒç»­å­˜åœ¨

```bash
# æ£€æŸ¥å¹¶ä¿®å¤æƒé™
sudo chown -R 1000:1000 logs/
chmod -R 755 logs/

# æˆ–è€…ä½¿ç”¨Dockerç”¨æˆ·ID
docker exec llxrice_api id
# ä½¿ç”¨è¿”å›çš„UID:GID
```

### 2. ç½‘ç»œè¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥Dockerç½‘ç»œ
docker network ls
docker network inspect bridge

# æµ‹è¯•è¿æ¥
docker exec llxrice_api ping host.docker.internal
docker exec llxrice_api telnet host.docker.internal 5432
```

### 3. æ•°æ®åº“è¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
docker ps | grep postgres
netstat -tlnp | grep 5432

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -p 5432 -U llxrice_user -d llxrice
```

### 4. Redisè¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
docker ps | grep redis
netstat -tlnp | grep 6379

# æµ‹è¯•Redisè¿æ¥
redis-cli -h localhost -p 6379 ping
```

## ğŸš€ ä¸€é”®ä¿®å¤å‘½ä»¤

### æœ€å¸¸ç”¨çš„ä¿®å¤å‘½ä»¤

```bash
# Linux/Mac - è‡ªåŠ¨ä¿®å¤æ‰€æœ‰é—®é¢˜
./LLX.Server/scripts/fix-container-issues.sh -f

# Windows - è‡ªåŠ¨ä¿®å¤æ‰€æœ‰é—®é¢˜
.\LLX.Server\scripts\fix-container-issues.ps1 -Force
```

### ä»…é‡å¯æœåŠ¡

```bash
# Linux/Mac
./LLX.Server/scripts/fix-container-issues.sh -r

# Windows
.\LLX.Server\scripts\fix-container-issues.ps1 -RestartOnly
```

## ğŸ“‹ ä¿®å¤æ£€æŸ¥æ¸…å•

### ä¿®å¤å‰æ£€æŸ¥

- [ ] ç¡®è®¤åœ¨é¡¹ç›®æ ¹ç›®å½•
- [ ] DockeræœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] æœ‰ç®¡ç†å‘˜æƒé™ï¼ˆLinux/Macï¼‰

### ä¿®å¤åéªŒè¯

- [ ] å®¹å™¨æ­£å¸¸è¿è¡Œ
- [ ] æ—¥å¿—æ–‡ä»¶å¯ä»¥å†™å…¥
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redisè¿æ¥æ­£å¸¸
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] APIç«¯ç‚¹å¯è®¿é—®

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç½‘ç»œé…ç½®

- **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨ `host.docker.internal`
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨å…·ä½“çš„IPåœ°å€
- **Docker Compose**ï¼šä½¿ç”¨æœåŠ¡å

### 2. æƒé™ç®¡ç†

- ç¡®ä¿æ—¥å¿—ç›®å½•æƒé™æ­£ç¡®
- ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨
- æ­£ç¡®è®¾ç½®æ–‡ä»¶æ‰€æœ‰æƒ

### 3. ç¯å¢ƒå˜é‡

- ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†é…ç½®
- é¿å…ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ï¼š

1. **å®¹å™¨æ—¥å¿—**ï¼š`docker logs llxrice_api`
2. **ç¯å¢ƒé…ç½®**ï¼š`cat .env`
3. **ç³»ç»Ÿä¿¡æ¯**ï¼š`docker version`
4. **ç½‘ç»œé…ç½®**ï¼š`docker network ls`

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-10-22  
**é€‚ç”¨ç¯å¢ƒ**ï¼šLinux, Windows, Docker
