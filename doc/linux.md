# Linux è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»äº†æ—é¾é¦™å¤§ç±³å•†åŸåç«¯æœåŠ¡åœ¨ Linux ç¯å¢ƒä¸‹çš„æ‰€æœ‰è„šæœ¬å·¥å…·ï¼ŒåŒ…æ‹¬éƒ¨ç½²ã€æ›´æ–°ã€æµ‹è¯•ã€ç»´æŠ¤ç­‰åŠŸèƒ½ã€‚

## ğŸš€ éƒ¨ç½²è„šæœ¬

### 1. deploy-api-only.sh - APIæœåŠ¡ç‹¬ç«‹éƒ¨ç½²è„šæœ¬

**åŠŸèƒ½**ï¼šä»…éƒ¨ç½² API æœåŠ¡ï¼Œä¸éƒ¨ç½²æ•°æ®åº“å’Œ Redisï¼ˆé€‚ç”¨äºå·²æœ‰å¤–éƒ¨æ•°æ®åº“å’Œç¼“å­˜çš„æƒ…å†µï¼‰

**ç”¨æ³•**ï¼š
```bash
./deploy-api-only.sh [é€‰é¡¹]
```

**é€‰é¡¹**ï¼š
- `-e, --environment <env>` - éƒ¨ç½²ç¯å¢ƒ (development/production) [é»˜è®¤: production]
- `-b, --build` - å¼ºåˆ¶é‡æ–°æ„å»º Docker é•œåƒ
- `-n, --no-build` - ä½¿ç”¨å·²æœ‰çš„æ„å»ºæ–‡ä»¶ï¼Œä¸é‡æ–°ç¼–è¯‘ .NET é¡¹ç›®
- `-f, --force` - å¼ºåˆ¶é‡æ–°éƒ¨ç½²ï¼ˆåœæ­¢å¹¶åˆ é™¤ç°æœ‰å®¹å™¨ï¼‰
- `-h, --help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

**ç¤ºä¾‹**ï¼š
```bash
# æ ‡å‡†éƒ¨ç½²
./deploy-api-only.sh

# é‡æ–°æ„å»ºé•œåƒå¹¶éƒ¨ç½²
./deploy-api-only.sh -b

# ä½¿ç”¨å·²æ„å»ºçš„æ–‡ä»¶éƒ¨ç½²
./deploy-api-only.sh -n

# å¼ºåˆ¶é‡æ–°éƒ¨ç½²
./deploy-api-only.sh -f

# å¼€å‘ç¯å¢ƒéƒ¨ç½²
./deploy-api-only.sh -e development
```

**å‰ææ¡ä»¶**ï¼š
1. PostgreSQL æ•°æ®åº“å·²è¿è¡Œå¹¶å¯è®¿é—®
2. Redis ç¼“å­˜å·²è¿è¡Œå¹¶å¯è®¿é—®
3. .env æ–‡ä»¶å·²æ­£ç¡®é…ç½®æ•°æ®åº“å’Œ Redis è¿æ¥ä¿¡æ¯

### 2. deploy.sh - å®Œæ•´æœåŠ¡éƒ¨ç½²è„šæœ¬

**åŠŸèƒ½**ï¼šéƒ¨ç½²å®Œæ•´çš„åç«¯æœåŠ¡ï¼ŒåŒ…æ‹¬ APIã€æ•°æ®åº“å’Œ Redis

**ç”¨æ³•**ï¼š
```bash
./deploy.sh [é€‰é¡¹]
```

**é€‰é¡¹**ï¼š
- `-e, --environment <env>` - éƒ¨ç½²ç¯å¢ƒ (development/production) [é»˜è®¤: production]
- `-b, --build` - å¼ºåˆ¶é‡æ–°æ„å»ºé•œåƒ
- `-p, --pull` - æ‹‰å–æœ€æ–°é•œåƒ
- `-f, --force` - å¼ºåˆ¶é‡æ–°éƒ¨ç½²ï¼ˆåœæ­¢å¹¶åˆ é™¤ç°æœ‰å®¹å™¨ï¼‰
- `-h, --help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

**ç¤ºä¾‹**ï¼š
```bash
# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
./deploy.sh

# å¼€å‘ç¯å¢ƒéƒ¨ç½²
./deploy.sh -e development

# å¼ºåˆ¶é‡æ–°æ„å»ºå¹¶éƒ¨ç½²
./deploy.sh -b -f

# æ‹‰å–æœ€æ–°é•œåƒå¹¶éƒ¨ç½²
./deploy.sh -p
```

## ğŸ”„ æ›´æ–°è„šæœ¬

### 3. update-api.sh - APIæœåŠ¡å¿«é€Ÿæ›´æ–°è„šæœ¬

**åŠŸèƒ½**ï¼šå¿«é€Ÿæ›´æ–°å·²éƒ¨ç½²çš„ API æœåŠ¡

**ç”¨æ³•**ï¼š
```bash
./update-api.sh [é€‰é¡¹]
```

**é€‰é¡¹**ï¼š
- `-b, --backup` - æ›´æ–°å‰åˆ›å»ºå¤‡ä»½
- `-f, --force` - å¼ºåˆ¶æ›´æ–°ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
- `-r, --rollback` - å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
- `-v, --version <version>` - æŒ‡å®šç‰ˆæœ¬å·
- `-h, --help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

**ç¤ºä¾‹**ï¼š
```bash
# æ ‡å‡†æ›´æ–°
./update-api.sh

# åˆ›å»ºå¤‡ä»½åæ›´æ–°
./update-api.sh -b

# å¼ºåˆ¶æ›´æ–°
./update-api.sh -f

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
./update-api.sh -r

# æ›´æ–°åˆ°æŒ‡å®šç‰ˆæœ¬
./update-api.sh -v 1.2.3
```

## ğŸ”§ ç»´æŠ¤è„šæœ¬

### 4. fix-container-issues.sh - å®¹å™¨è¿è¡Œé—®é¢˜ä¿®å¤è„šæœ¬

**åŠŸèƒ½**ï¼šè§£å†³å®¹å™¨è¿è¡Œä¸­çš„å¸¸è§é—®é¢˜ï¼Œå¦‚æ—¥å¿—æƒé™å’Œç½‘ç»œè¿æ¥é—®é¢˜

**ç”¨æ³•**ï¼š
```bash
./fix-container-issues.sh [é€‰é¡¹]
```

**é€‰é¡¹**ï¼š
- `-f, --force` - å¼ºåˆ¶ä¿®å¤ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
- `-l, --logs` - ä»…ä¿®å¤æ—¥å¿—æƒé™é—®é¢˜
- `-n, --network` - ä»…ä¿®å¤ç½‘ç»œè¿æ¥é—®é¢˜
- `-h, --help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

**ç¤ºä¾‹**ï¼š
```bash
# ä¿®å¤æ‰€æœ‰é—®é¢˜
./fix-container-issues.sh

# å¼ºåˆ¶ä¿®å¤
./fix-container-issues.sh -f

# ä»…ä¿®å¤æ—¥å¿—æƒé™
./fix-container-issues.sh -l

# ä»…ä¿®å¤ç½‘ç»œè¿æ¥
./fix-container-issues.sh -n
```

**ä¿®å¤çš„é—®é¢˜**ï¼š
- æ—¥å¿—æ–‡ä»¶æƒé™é—®é¢˜
- æ•°æ®åº“è¿æ¥é—®é¢˜ï¼ˆlocalhost æ”¹ä¸º host.docker.internalï¼‰
- Redis è¿æ¥é—®é¢˜

### 5. setup-permissions.sh - æƒé™è®¾ç½®è„šæœ¬

**åŠŸèƒ½**ï¼šä¸ºæ‰€æœ‰è„šæœ¬æ–‡ä»¶è®¾ç½®æ­£ç¡®çš„æ‰§è¡Œæƒé™

**ç”¨æ³•**ï¼š
```bash
./setup-permissions.sh
```

**åŠŸèƒ½**ï¼š
- ä¸ºæ‰€æœ‰ .sh è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
- æ£€æŸ¥é¡¹ç›®ç›®å½•ç»“æ„
- éªŒè¯è„šæœ¬æ–‡ä»¶å®Œæ•´æ€§

## ğŸ—„ï¸ æ•°æ®åº“è„šæœ¬

### 6. migrate-database.sh - æ•°æ®åº“è¿ç§»è„šæœ¬

**åŠŸèƒ½**ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»æ“ä½œ

**ç”¨æ³•**ï¼š
```bash
./migrate-database.sh <æ•°æ®åº“ç±»å‹> <è¿æ¥å­—ç¬¦ä¸²> [è¿ç§»åç§°]
```

**å‚æ•°**ï¼š
- `æ•°æ®åº“ç±»å‹` - PostgreSQL, SqlServer, MySql, Sqlite
- `è¿æ¥å­—ç¬¦ä¸²` - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- `è¿ç§»åç§°` - è¿ç§»åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º InitialCreateï¼‰

**ç¤ºä¾‹**ï¼š
```bash
# PostgreSQL è¿ç§»
./migrate-database.sh PostgreSQL "Host=localhost;Port=5432;Database=llxrice;Username=user;Password=pass" InitialCreate

# SqlServer è¿ç§»
./migrate-database.sh SqlServer "Server=localhost;Database=llxrice;User Id=user;Password=pass" InitialCreate
```

### 7. switch-database.sh - æ•°æ®åº“åˆ‡æ¢è„šæœ¬

**åŠŸèƒ½**ï¼šåˆ‡æ¢æ•°æ®åº“ç±»å‹å’Œè¿æ¥å­—ç¬¦ä¸²

**ç”¨æ³•**ï¼š
```bash
./switch-database.sh <æ•°æ®åº“ç±»å‹> <è¿æ¥å­—ç¬¦ä¸²>
```

**å‚æ•°**ï¼š
- `æ•°æ®åº“ç±»å‹` - PostgreSQL, SqlServer, MySql, Sqlite
- `è¿æ¥å­—ç¬¦ä¸²` - æ–°çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

**ç¤ºä¾‹**ï¼š
```bash
# åˆ‡æ¢åˆ° PostgreSQL
./switch-database.sh PostgreSQL "Host=localhost;Port=5432;Database=llxrice;Username=user;Password=pass"

# åˆ‡æ¢åˆ° SqlServer
./switch-database.sh SqlServer "Server=localhost;Database=llxrice;User Id=user;Password=pass"
```

## ğŸ“‹ è„šæœ¬ä½¿ç”¨æµç¨‹

### é¦–æ¬¡éƒ¨ç½²æµç¨‹
```bash
# 1. è®¾ç½®è„šæœ¬æƒé™
./setup-permissions.sh

# 2. é€‰æ‹©éƒ¨ç½²æ–¹å¼
# æ–¹å¼Aï¼šå®Œæ•´éƒ¨ç½²ï¼ˆåŒ…å«æ•°æ®åº“å’ŒRedisï¼‰
./deploy.sh -e production

# æ–¹å¼Bï¼šä»…éƒ¨ç½²APIæœåŠ¡ï¼ˆä½¿ç”¨å¤–éƒ¨æ•°æ®åº“å’ŒRedisï¼‰
./deploy-api-only.sh -e production
```

### æ—¥å¸¸ç»´æŠ¤æµç¨‹
```bash
# 1. æ›´æ–°APIæœåŠ¡
./update-api.sh -b

# 2. ä¿®å¤å®¹å™¨é—®é¢˜ï¼ˆå¦‚éœ€è¦ï¼‰
./fix-container-issues.sh

# 3. æ•°æ®åº“è¿ç§»ï¼ˆå¦‚éœ€è¦ï¼‰
./migrate-database.sh PostgreSQL "your_connection_string" "MigrationName"
```

### æ•…éšœæ’é™¤æµç¨‹
```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a

# 2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs llxrice_api

# 3. ä¿®å¤å®¹å™¨é—®é¢˜
./fix-container-issues.sh -f

# 4. é‡å¯æœåŠ¡
docker restart llxrice_api
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æƒé™é—®é¢˜
- ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼š`chmod +x *.sh`
- ä½¿ç”¨ `./setup-permissions.sh` è‡ªåŠ¨è®¾ç½®æƒé™

### ç¯å¢ƒé…ç½®
- ç¡®ä¿ `.env` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
- éªŒè¯æ•°æ®åº“å’Œ Redis è¿æ¥é…ç½®
- æ£€æŸ¥ Docker å’Œ Docker Compose æ˜¯å¦å®‰è£…

### ç½‘ç»œé—®é¢˜
- å®¹å™¨å†…ä½¿ç”¨ `host.docker.internal` è®¿é—®å®¿ä¸»æœºæœåŠ¡
- ç¡®ä¿é˜²ç«å¢™å…è®¸ç›¸åº”ç«¯å£è®¿é—®

### æ—¥å¿—é—®é¢˜
- æ—¥å¿—æ–‡ä»¶æƒé™é—®é¢˜å¯é€šè¿‡ `./fix-container-issues.sh -l` ä¿®å¤
- æ—¥å¿—ç›®å½•ï¼š`./logs/`

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [APIæœåŠ¡Linuxéƒ¨ç½²æŒ‡å—](./APIæœåŠ¡Linuxéƒ¨ç½²æŒ‡å—.md)
- [APIæœåŠ¡Linuxå¿«é€Ÿéƒ¨ç½²](./APIæœåŠ¡Linuxå¿«é€Ÿéƒ¨ç½².md)
- [Linuxéƒ¨ç½²æ–¹æ¡ˆæ€»ç»“](./Linuxéƒ¨ç½²æ–¹æ¡ˆæ€»ç»“.md)
- [å®¹å™¨è¿è¡Œé—®é¢˜ä¿®å¤æŒ‡å—](./å®¹å™¨è¿è¡Œé—®é¢˜ä¿®å¤æŒ‡å—.md)

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹è„šæœ¬å¸®åŠ©ä¿¡æ¯ï¼š`./script-name.sh -h`
2. æ£€æŸ¥å®¹å™¨æ—¥å¿—ï¼š`docker logs llxrice_api`
3. è¿è¡Œé—®é¢˜ä¿®å¤è„šæœ¬ï¼š`./fix-container-issues.sh`
4. å‚è€ƒç›¸å…³æ–‡æ¡£å’Œæ•…éšœæ’é™¤æŒ‡å—
