# 林龍香大米商城后端服务开发计划

## 📋 项目概述

基于您提供的完整设计方案，我将为"林龍香大米商城"开发一个基于 .NET 8 Minimal API 的现代化后端服务，采用 PostgreSQL + Redis 的技术栈，支持微信小程序对接。

### 🎯 开发目标

1. **核心功能**: 商品管理、地址管理、订单管理、运费计算
2. **技术特点**: 高性能、可扩展、易维护、生产就绪
3. **部署方式**: Docker 容器化部署，支持一键启动
4. **开发效率**: 使用 Cursor AI 辅助开发，遵循严格代码规范

---

## 📅 开发计划详细安排

### 第一阶段：项目基础架构搭建 (1-2天)

#### 1.1 项目结构调整
- [ ] 重构现有项目结构，按照设计方案组织代码
- [ ] 创建分层架构：Models、Services、Repositories、Endpoints
- [ ] 配置 Entity Framework Core 和 PostgreSQL
- [ ] 配置 Redis 缓存服务
- [ ] 配置 Serilog 结构化日志

#### 1.2 核心基础设施
- [ ] 实现统一响应格式 `ApiResponse<T>`
- [ ] 实现全局异常处理中间件
- [ ] 实现请求日志中间件
- [ ] 配置健康检查端点
- [ ] 配置 Swagger/OpenAPI 文档

#### 1.3 数据库设计
- [ ] 创建 5 张核心表：Products、Addresses、Orders、OrderItems、ShippingRates
- [ ] 实现数据库迁移
- [ ] 插入初始数据（商品、运费配置、示例地址）
- [ ] 创建数据库视图和存储过程

### 第二阶段：核心业务功能开发 (3-4天)

#### 2.1 商品管理模块
- [ ] 实现商品实体和 DTO
- [ ] 实现商品仓储层
- [ ] 实现商品服务层（含 Redis 缓存）
- [ ] 实现商品 API 端点
- [ ] 支持商品 CRUD 操作

#### 2.2 地址管理模块
- [ ] 实现地址实体和 DTO
- [ ] 实现地址仓储层
- [ ] 实现地址服务层
- [ ] 实现地址 API 端点
- [ ] **实现智能地址识别功能**（核心特色）

#### 2.3 订单管理模块
- [ ] 实现订单和订单明细实体
- [ ] 实现订单仓储层
- [ ] 实现订单服务层
- [ ] 实现订单 API 端点
- [ ] 支持订单创建、查询、状态更新

#### 2.4 运费计算模块
- [ ] 实现运费配置管理
- [ ] 实现运费计算服务
- [ ] 实现运费 API 端点
- [ ] 支持基于省份和重量的动态计算

### 第三阶段：高级功能和优化 (2-3天)

#### 3.1 缓存优化
- [ ] 实现 Redis 缓存服务
- [ ] 配置缓存策略（商品列表、运费配置）
- [ ] 实现缓存失效机制
- [ ] 防缓存雪崩和穿透

#### 3.2 性能优化
- [ ] 数据库查询优化
- [ ] 异步编程最佳实践
- [ ] 连接池配置
- [ ] 分页查询实现

#### 3.3 监控和日志
- [ ] 完善结构化日志记录
- [ ] 实现健康检查
- [ ] 配置日志轮转
- [ ] 添加性能监控

### 第四阶段：部署和测试 (1-2天)

#### 4.1 Docker 化部署
- [ ] 完善 Dockerfile 配置
- [ ] 完善 docker-compose.yml
- [ ] 配置环境变量
- [ ] 实现一键部署脚本

#### 4.2 功能测试
- [ ] API 接口测试
- [ ] 数据库功能测试
- [ ] 缓存功能测试
- [ ] 性能压力测试

#### 4.3 文档完善
- [ ] 更新 API 文档
- [ ] 完善部署指南
- [ ] 编写使用说明

---

## 🛠️ 技术实现细节

### 核心技术栈
- **后端框架**: .NET 8 Minimal API
- **数据库**: PostgreSQL 16
- **缓存**: Redis 7.2
- **ORM**: Entity Framework Core 8
- **日志**: Serilog
- **容器化**: Docker + Docker Compose

### 项目结构
```
LLX.Server/
├── Models/
│   ├── Entities/          # 数据库实体
│   └── DTOs/             # 数据传输对象
├── Data/
│   ├── AppDbContext.cs   # EF Core 上下文
│   └── Migrations/       # 数据库迁移
├── Services/             # 业务逻辑层
├── Repositories/         # 数据访问层
├── Endpoints/           # Minimal API 端点
├── Utils/               # 工具类
├── Middleware/          # 中间件
└── Extensions/          # 扩展方法
```

### 核心功能特色
1. **智能地址识别**: 自动解析省市区信息
2. **Redis 缓存**: 热点数据缓存，提升性能
3. **运费计算**: 基于省份和重量的动态计算
4. **统一响应**: ApiResponse 统一格式
5. **健康检查**: 完整的监控体系

---

## 📊 开发时间估算

| 阶段 | 功能模块 | 预计时间 | 优先级 |
|------|----------|----------|--------|
| 第一阶段 | 基础架构 | 1-2天 | 高 |
| 第二阶段 | 核心业务 | 3-4天 | 高 |
| 第三阶段 | 高级功能 | 2-3天 | 中 |
| 第四阶段 | 部署测试 | 1-2天 | 高 |
| **总计** | | **7-11天** | |

---

## 🎯 交付成果

### 代码交付
- [ ] 完整的 .NET 8 Minimal API 项目
- [ ] 数据库初始化脚本
- [ ] Docker 部署配置
- [ ] 完整的单元测试

### 文档交付
- [ ] API 接口文档
- [ ] 部署操作指南
- [ ] 开发规范文档
- [ ] 小程序对接说明

### 功能交付
- [ ] 商品管理（CRUD）
- [ ] 地址管理（含智能识别）
- [ ] 订单管理（完整流程）
- [ ] 运费计算（动态计算）
- [ ] 缓存优化（Redis）
- [ ] 健康检查（监控）

---

## 🚀 开发优势

1. **技术先进**: 采用 .NET 8 最新特性，性能优异
2. **架构清晰**: 分层架构，职责明确，易于维护
3. **部署简单**: Docker 一键部署，环境一致
4. **扩展性强**: 预留鉴权接口，支持后续功能扩展
5. **生产就绪**: 包含日志、监控、异常处理等完整功能

---

## 📋 详细开发任务清单

### 第一阶段任务 (1-2天)

#### 项目初始化
- [ ] 安装必要的 NuGet 包
  - [ ] Microsoft.EntityFrameworkCore
  - [ ] Microsoft.EntityFrameworkCore.Design
  - [ ] Npgsql.EntityFrameworkCore.PostgreSQL
  - [ ] StackExchange.Redis
  - [ ] Serilog.AspNetCore
  - [ ] Swashbuckle.AspNetCore
- [ ] 创建项目文件夹结构
- [ ] 配置 appsettings.json 和 appsettings.Development.json

#### 数据库配置
- [ ] 创建 AppDbContext
- [ ] 配置实体类
- [ ] 创建数据库迁移
- [ ] 执行数据库初始化脚本

#### 基础服务配置
- [ ] 配置 Redis 连接
- [ ] 配置 Serilog 日志
- [ ] 配置健康检查
- [ ] 配置 Swagger

### 第二阶段任务 (3-4天)

#### 商品管理
- [ ] 创建 Product 实体
- [ ] 创建 ProductDto、CreateProductDto、UpdateProductDto
- [ ] 实现 IProductRepository 和 ProductRepository
- [ ] 实现 IProductService 和 ProductService
- [ ] 实现 ProductEndpoints
- [ ] 添加 Redis 缓存支持

#### 地址管理
- [ ] 创建 Address 实体
- [ ] 创建 AddressDto、CreateAddressDto、UpdateAddressDto
- [ ] 实现 IAddressRepository 和 AddressRepository
- [ ] 实现 IAddressService 和 AddressService
- [ ] 实现 AddressEndpoints
- [ ] **实现 AddressParser 智能地址识别**

#### 订单管理
- [ ] 创建 Order 和 OrderItem 实体
- [ ] 创建订单相关 DTO
- [ ] 实现 IOrderRepository 和 OrderRepository
- [ ] 实现 IOrderService 和 OrderService
- [ ] 实现 OrderEndpoints
- [ ] 实现订单号生成逻辑

#### 运费计算
- [ ] 创建 ShippingRate 实体
- [ ] 创建运费相关 DTO
- [ ] 实现 IShippingService 和 ShippingService
- [ ] 实现 ShippingEndpoints
- [ ] 实现运费计算算法

### 第三阶段任务 (2-3天)

#### 缓存优化
- [ ] 实现 ICacheService 和 RedisCacheService
- [ ] 在商品服务中集成缓存
- [ ] 在运费服务中集成缓存
- [ ] 实现缓存失效策略

#### 中间件开发
- [ ] 实现 ExceptionMiddleware
- [ ] 实现 LoggingMiddleware
- [ ] 配置中间件管道

#### 工具类开发
- [ ] 实现 OrderNumberGenerator
- [ ] 完善 AddressParser
- [ ] 实现其他工具类

### 第四阶段任务 (1-2天)

#### Docker 配置
- [ ] 完善 Dockerfile
- [ ] 完善 docker-compose.yml
- [ ] 创建 .env 示例文件
- [ ] 测试 Docker 部署

#### 测试和验证
- [ ] 测试所有 API 端点
- [ ] 验证数据库功能
- [ ] 验证缓存功能
- [ ] 性能测试

#### 文档更新
- [ ] 更新 README
- [ ] 完善 API 文档
- [ ] 编写部署说明

---

## 🔧 开发环境要求

### 必需软件
- [ ] .NET 8 SDK
- [ ] PostgreSQL 16
- [ ] Redis 7.2
- [ ] Docker Desktop
- [ ] Visual Studio Code 或 Visual Studio 2022

### 推荐工具
- [ ] Cursor AI 编辑器
- [ ] Postman 或 Insomnia（API 测试）
- [ ] pgAdmin（数据库管理）
- [ ] RedisInsight（Redis 管理）

---

## 📝 开发规范

### 代码规范
- 遵循 .cursorrules 中定义的规范
- 使用异步编程模式
- 统一使用 ApiResponse 响应格式
- 添加详细的 XML 注释

### Git 提交规范
```
feat(module): 添加新功能
fix(module): 修复问题
docs(module): 更新文档
refactor(module): 重构代码
perf(module): 性能优化
test(module): 添加测试
```

### 分支管理
- `main`: 主分支，稳定版本
- `develop`: 开发分支
- `feature/*`: 功能分支
- `hotfix/*`: 热修复分支

---

## 🚨 风险控制

### 技术风险
- **数据库连接问题**: 提前测试数据库连接配置
- **Redis 缓存问题**: 实现缓存降级机制
- **性能问题**: 进行压力测试，优化查询

### 进度风险
- **功能复杂度**: 智能地址识别可能需要额外时间
- **集成测试**: 预留充足的测试时间
- **部署问题**: 提前验证 Docker 配置

### 质量风险
- **代码质量**: 严格遵循开发规范
- **测试覆盖**: 确保核心功能有测试覆盖
- **文档完整性**: 及时更新相关文档

---

## 📞 沟通机制

### 进度汇报
- 每日进度更新
- 遇到问题及时沟通
- 重要决策提前讨论

### 问题反馈
- 技术问题：及时提出，共同解决
- 需求变更：评估影响，调整计划
- 质量反馈：持续改进

---

## ✅ 验收标准

### 功能验收
- [ ] 所有 API 接口正常工作
- [ ] 数据库操作正确
- [ ] 缓存功能正常
- [ ] 智能地址识别准确率 > 90%
- [ ] 运费计算准确

### 性能验收
- [ ] API 响应时间 < 200ms
- [ ] 支持并发用户 > 100
- [ ] 数据库查询优化
- [ ] 内存使用合理

### 部署验收
- [ ] Docker 一键部署成功
- [ ] 健康检查正常
- [ ] 日志记录完整
- [ ] 监控告警正常

---

## 🎉 项目里程碑

### 里程碑 1: 基础架构完成
- 时间：第 2 天
- 目标：项目结构搭建完成，数据库连接正常

### 里程碑 2: 核心功能完成
- 时间：第 6 天
- 目标：四大核心模块功能完成

### 里程碑 3: 优化完成
- 时间：第 9 天
- 目标：缓存优化和性能调优完成

### 里程碑 4: 项目交付
- 时间：第 11 天
- 目标：完整功能交付，文档齐全

---

## 📚 参考文档

- [后端服务设计方案.md](./后端服务设计方案.md)
- [数据库初始化脚本.sql](./数据库初始化脚本.sql)
- [DEPLOYMENT.md](./DEPLOYMENT.md)
- [README-Backend.md](./README-Backend.md)
- [.cursorrules](../.cursorrules)

---

**文档版本**: v1.0  
**创建日期**: 2025-01-17  
**最后更新**: 2025-01-17  
**适用版本**: .NET 8 + PostgreSQL 16 + Redis 7.2

---

© 2025 林龍香大米商城后端服务开发计划
